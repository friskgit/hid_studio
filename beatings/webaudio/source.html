<html>
    <head>
	<!-- This example is based on the instructions on this site:
	     http://faust.grame.fr/news/2017/08/18/using-webaudio-api.html
	     This file needs to be served by a server, f.ex. by running
	     python -m SimpleHTTPServer

	     The support files are generated by running faust2wasm on the 
	     .dsp file, in this case:

	     faust2wasm dspsource.dsp
	-->
	<title>WASM</title>
	<script src="dspsource.js"></script>
    </head>
    <body>
	<h1>WASM</h1>

	<address>
	    <a href="mailto:mail@henrikfrisk.com">Henrik Frisk</a>
	</address>

	<P> Volume:
	    <input type="range" oninput="changeVolume(event) "min="0" max="1" value="0.5" step="0.01"/>
	</P>

	<script>
	 var isWebKitAudio = (typeof (webkitAudioContext) !== "undefined");
	 var audio_context = (isWebKitAudio) ? new webkitAudioContext() : new AudioContext();
	 var noise = null;
	 
	 // Slider handler to change the 'noise' volume
	 function changeVolume(event)
	 {
	     noise.setParamValue("/dspsource/level", parseFloat(event.target.value));
	     console.log(event.target.value);
	 }

	 function startsound()
	 {
	     // Create the Faust generated node
	     faust.createdspsource(audio_context, 1024,
				 function (node) {
				     noise = node;
				     console.log(noise.getJSON());
				     // Print paths to be used with 'setParamValue'
				     console.log(noise.getParams());
				     // Connect it to output as a regular WebAudio node
				     noise.connect(audio_context.destination);
				 });
	 }
	 
	 window.addEventListener("load", startsound);
	</script>
    </body>
</html>

